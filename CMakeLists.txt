# CMake æœ€ä½ç‰ˆæœ¬è¦æ±‚
cmake_minimum_required(VERSION 3.14)

# é¡¹ç›®åç§°ä¸è¯­è¨€
project(mini_redis_cpp VERSION 0.1.0 LANGUAGES CXX)

# C++ æ ‡å‡†è®¾ç½®
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_CXX_EXTENSIONS OFF)  # ç¦ç”¨ GCC/Clang æ‰©å±•ï¼Œä¿è¯å¯ç§»æ¤æ€§

# ç¼–è¯‘é€‰é¡¹ï¼ˆå¯ç”¨è­¦å‘Šï¼Œè°ƒè¯•ç¬¦å·ï¼‰
if(CMAKE_BUILD_TYPE STREQUAL "Debug")
    add_compile_options(-g -O0 -Wall -Wextra -Wpedantic)
else()
    add_compile_options(-O2 -DNDEBUG)
endif()

# æŸ¥æ‰¾çº¿ç¨‹åº“ï¼ˆè™½ç„¶å•çº¿ç¨‹ï¼Œä½†æŸäº›ç³»ç»Ÿéœ€è¦é“¾æ¥ pthreadï¼‰
find_package(Threads REQUIRED)

# æºæ–‡ä»¶åˆ—è¡¨ï¼ˆæŒ‰æ¨¡å—ç»„ç»‡ï¼‰
set(SOURCES
    main.cpp
    Server.cpp
    Connection.cpp
    Protocol.cpp
    Database.cpp
    Command.cpp
    RedisObject.cpp
    StringObject.cpp   # ğŸ‘ˆ ç¡®ä¿åŒ…å«
    HashObject.cpp     # ğŸ‘ˆ ç¡®ä¿åŒ…å«
    Dict.cpp           # ğŸ‘ˆ ç¡®ä¿åŒ…å«
    Rdb.cpp
    # å¦‚æœåç»­æ·»åŠ  Config.cppï¼Œä¹ŸåŠ åœ¨è¿™é‡Œ
)

# åˆ›å»ºå¯æ‰§è¡Œæ–‡ä»¶
add_executable(mini_redis_server ${SOURCES})

# é“¾æ¥ç³»ç»Ÿçº¿ç¨‹åº“ï¼ˆLinux/macOS éœ€è¦ï¼‰
target_link_libraries(mini_redis_server PRIVATE Threads::Threads)

# ï¼ˆå¯é€‰ï¼‰è®¾ç½®è¾“å‡ºç›®å½•
set_target_properties(mini_redis_server PROPERTIES
    RUNTIME_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/bin
)

# å®‰è£…è§„åˆ™ï¼ˆå¯é€‰ï¼‰
install(TARGETS mini_redis_server
        DESTINATION bin)

